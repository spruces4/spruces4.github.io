<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="ie=edge" />
<link rel="stylesheet" href="/_assets/main.css" />

    <title>0x01 tomcat - Alfie Cheung</title>
  <link rel="stylesheet" href="/_markdown_plugin_assets/highlight.js/atom-one-light.css" /></head>
  <body>
    <div class="main">
      <nav class="navigation">
        <a href="/">Alfie Cheung</a>
      </nav>
      <article>
        <header>
          <h1 class="article-title">0x01 tomcat</h1>
          <div class="article-info">
            <div>
              <span
                >Created At：<time datetime="1710553223452"
                  >2024-03-16 09:40</time
                ></span
              >
              <span
                >Updated At：<time datetime="1711251022299"
                  >2024-03-24 11:30</time
                ></span
              >
            </div>
            
          </div>
        </header>
        <div class="article-content markdown-body"><nav class="table-of-contents"><ul><li><a href="#tomcat介绍">tomcat介绍</a><ul><li><a href="#版本信息">版本信息</a></li><li><a href="#体系">体系</a></li></ul></li><li><a href="#tomcat安装">tomcat安装</a><ul><li><a href="#包安装">包安装</a></li><li><a href="#源代码安装">源代码安装</a><ul><li><a href="#java安装">java安装</a></li></ul></li><li><a href="#tomcat源代码">tomcat源代码</a></li></ul></li></ul></nav><h1 id="tomcat介绍">tomcat介绍</h1>
<blockquote>
<p>tomcat是免费开源的<code>web应用服务器</code>，在中小型系统和并发访问用户不是很多的场合下被普遍使用。<br />
tomcat是<code>servlet和JSP容器</code>、还能处理静态网页。<br />
tomcat 仅仅实现了Java EE规范中与<code>Servlet</code>、<code>JSP</code>相关的类库，是<code>JavaEE不完整实现</code>。</p>
</blockquote>
<h2 id="版本信息">版本信息</h2>
<blockquote>
<p><a title="https://tomcat.apache.org/whichversion.html" href="https://tomcat.apache.org/whichversion.html">REF</a><br />
需要注意安装的<code>Apache Tomcat Version</code>与<code>Supported Java Versions</code>相匹配</p>
</blockquote>
<table>
<thead>
<tr>
<th>Servlet Spec</th>
<th>JSP Spec</th>
<th>EL Spec</th>
<th>WebSocket Spec</th>
<th>Authentication (JASPIC) Spec</th>
<th><code>Apache Tomcat Version</code></th>
<th>Latest Released Version</th>
<th><code>Supported Java Versions</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>6.1</td>
<td>4.0</td>
<td>6.0</td>
<td>2.2</td>
<td>3.1</td>
<td>11.0.x</td>
<td>11.0.0-M18 (alpha)</td>
<td>17 and later</td>
</tr>
<tr>
<td>6.0</td>
<td>3.1</td>
<td>5.0</td>
<td>2.1</td>
<td>3.0</td>
<td>10.1.x</td>
<td>10.1.19</td>
<td>11 and later</td>
</tr>
<tr>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>2.0</td>
<td>2.0</td>
<td>10.0.x (superseded)</td>
<td>10.0.27 (superseded)</td>
<td>8 and later</td>
</tr>
<tr>
<td>4.0</td>
<td>2.3</td>
<td>3.0</td>
<td>1.1</td>
<td>1.1</td>
<td>9.0.x</td>
<td>9.0.87</td>
<td>8 and later</td>
</tr>
<tr>
<td>3.1</td>
<td>2.3</td>
<td>3.0</td>
<td>1.1</td>
<td>1.1</td>
<td>8.5.x</td>
<td>8.5.99</td>
<td>7 and later</td>
</tr>
<tr>
<td>3.1</td>
<td>2.3</td>
<td>3.0</td>
<td>1.1</td>
<td>N/A</td>
<td>8.0.x (superseded)</td>
<td>8.0.53 (superseded)</td>
<td>7 and later</td>
</tr>
<tr>
<td>3.0</td>
<td>2.2</td>
<td>2.2</td>
<td>1.1</td>
<td>N/A</td>
<td>7.0.x (archived)</td>
<td>7.0.109 (archived)</td>
<td>6 and later <br class="jop-noMdConv" />(7 and later for WebSocket)</td>
</tr>
<tr>
<td>2.5</td>
<td>2.1</td>
<td>2.1</td>
<td>N/A</td>
<td>N/A</td>
<td>6.0.x (archived)</td>
<td>6.0.53 (archived)</td>
<td>5 and later</td>
</tr>
<tr>
<td>2.4</td>
<td>2.0</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>5.5.x (archived)</td>
<td>5.5.36 (archived)</td>
<td>1.4 and later</td>
</tr>
<tr>
<td>2.3</td>
<td>1.2</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>4.1.x (archived)</td>
<td>4.1.40 (archived)</td>
<td>1.3 and later</td>
</tr>
<tr>
<td>2.2</td>
<td>1.1</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
<td>3.3.x (archived)</td>
<td>3.3.2 (archived)</td>
<td>1.1 and later</td>
</tr>
</tbody>
</table>
<h2 id="体系">体系</h2>
<p><img src="/_resources/e2d2559ea9df40b08f6466ea72c65ec3.png" /><br />
<img src="/_resources/ceea9467162a4f5ebc03a214745d2e5e.png" /><br />
<img src="/_resources/fa4c72a5ba184da39b585783522c9cd9.png" /></p>
<ul>
<li>
<p><code>server</code>是顶级类，一个server算是一个tomcat实例，在此层次中可定义tomcat服务的监听端口。</p>
<ul>
<li><code>service</code>是server下的子组件，用于封装绑定connector和containor，并为它们提供一个名称属性。有了service就可以提供相关的服务，如监听TCP连接请求、处理http请求。注意server是管理整个tomcat实例的层次，它和提供服务没有关系。
<ul>
<li><code>connector</code>是连接器，定义http协议(默认)以及该协议的监听端口。连接器用于接收客户端请求并将containor处理的数据返回给客户端。</li>
<li>(<code>containor</code>称为容器)，它和connector连接器进行绑定。该容器内有4个子容器，包括：engine容器、host容器、context容器、Wrapper容器。容器用于分析、处理请求，并构建响应给connector以发送给客户端。它和connector是tomcat的心脏组件。</li>
<li><code>engine</code>容器定义servlet引擎，用于定义引擎的名称、默认的虚拟主机。引擎用于分析http请求并将请求转发给对应的虚拟主机。
<ul>
<li><code>host</code>容器用于定义虚拟主机。</li>
<li><code>context</code>容器用于定义webapp，一个context定义一个webapp。它是真正管理servlet容器的层次。
<ul>
<li><code>wrapper</code>容器对应的是真正的servlet容器，一个wrapper代表一个servlet，它负责管理一个Servlet，包括的Servlet的装载、初始化、执行以及资源回收。Wrapper是最底层的容器，一个context只能包含一个wrapper。在配置文件中，无法配置该容器的属性。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>小结</p>
<ul>
<li>一个<code>server</code>可以有多个<code>service</code></li>
<li>一个<code>service</code>可以有多个<code>connector</code>和唯一的<code>containor</code>。</li>
<li><code>containor</code>是容器类，从<code>containor</code>层次开始，真正进入<code>servlet</code>容器相关的过程</li>
<li><code>containor</code>含了唯一的<code>engine</code>容器</li>
<li><code>engine</code>容器中包含了一个或多个<code>host</code>容器</li>
<li><code>host</code>容器中包含了一个或多个<code>context</code>容器</li>
<li><code>context</code>容器中包含了唯一的<code>wrapper</code></li>
</ul>
</li>
<li>
<p>配置表现</p>
<div><pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">server</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">service</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">connector</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">engine</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">host</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">context</span> /&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">context</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">host</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">host</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">context</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">host</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">engine</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">service</span>&gt;</span>
         ......
    <span class="hljs-tag">&lt;/<span class="hljs-name">service</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">server</span>&gt;</span></code></pre></div>
</li>
</ul>
<h1 id="tomcat安装">tomcat安装</h1>
<h2 id="包安装">包安装</h2>
<div><pre class="hljs"><code><span class="hljs-comment"># CentOS / Rocky</span>
    <span class="hljs-comment"># 查询当前tomcat版本 (一般需要epel源)</span>
    yum list |grep tomcat

    <span class="hljs-comment"># 安装tomcat</span>
    yum -y install tomcat tomcat-admin-webapps tomcat-docs-webapp tomcat-webapps

    <span class="hljs-comment"># 开启tomcat</span>
    systemctl <span class="hljs-built_in">enable</span> --now tomcat.service

    <span class="hljs-comment"># 查看状态</span>
    systemctl status tomcat.service
    ss -tulnp
    journalctl -u tomcat.service
    ps aux|grep tomcat

    <span class="hljs-comment"># 验证</span>
    curl 127.0.0.1:8080

<span class="hljs-comment"># debian / ubuntu</span>
    <span class="hljs-comment"># 查询当前tomcat版本</span>
    apt list | grep tomcat

    <span class="hljs-comment"># 安装tomcat (该包名包含主版本号)</span>
    apt update &amp;&amp; apt -y install tomcat9 tomcat9-admin tomcat9- docs tomcat9-examples

    <span class="hljs-comment"># 开启tomcat</span>
    systemctl <span class="hljs-built_in">enable</span> --now tomcat.service

    <span class="hljs-comment"># 查看状态</span>
    systemctl status tomcat.service
    ss -tulnp
    journalctl -u tomcat.service
    ps aux|grep tomcat

    <span class="hljs-comment"># 验证</span>
    curl 127.0.0.1:8080</code></pre></div>
<h2 id="源代码安装">源代码安装</h2>
<h3 id="java安装">java安装</h3>
<ul>
<li>
<p>当前java商业支持，<code>java8</code>/<code>java11</code>/<code>java17</code><br />
<img src="/_resources/7062d3f52d774b9fac8f4dcf724dfd07.png" /></p>
</li>
<li>
<p>当前应用量最高<code>java8</code>/<code>java7</code>/<code>java11</code><br />
<img src="/_resources/f2fc6e8f505c466bac30ff0f938f80d8.png" /></p>
</li>
<li>
<p>当前使用量最多的jdk <code>oracl-jdk</code> / <code>open-jdk</code><br />
<img src="/_resources/ca26d5cc53054d1e83b4db2afa77137e.png" /></p>
</li>
</ul>
<div><pre class="hljs"><code><span class="hljs-comment"># 包安装jdk</span>
    <span class="hljs-comment"># CentOS</span>
        <span class="hljs-comment"># 确认需要安装的jdk版本</span>
        dnf list <span class="hljs-string">"*jdk*"</span>
        
        <span class="hljs-comment"># 安装1.8 openjdk</span>
        dnf -y install java-1.8.0-openjdk.x86_64 java-1.8.0-openjdk- devel
    <span class="hljs-comment"># Ubuntu</span>
        <span class="hljs-comment"># 确认所需下载的jdk版本</span>
        apt list | grep openjdk
        
        <span class="hljs-comment"># 安装1.8 openjdk</span>
        apt -y install openjdk-8-jdk
    
<span class="hljs-comment"># 源代码安装</span>
    <span class="hljs-comment"># 确认需要安装的jdk版本</span>
    &gt;&gt; oracle-jdk: 
      https://www.oracle.com/java/technologies/downloads/<span class="hljs-comment">#java8</span>
      https://www.oracle.com/java/technologies/downloads/<span class="hljs-comment">#java11</span>
    &gt;&gt; open-jdk:
      (openlogic) https://www.openlogic.com/openjdk-downloads
    
    <span class="hljs-comment"># 二进制安装</span>
        <span class="hljs-comment"># 安装1.8 jdk</span>
        dnf -y install jdk-8u241-linux-x64.rpm

        <span class="hljs-comment"># 配置JAVA_HOME</span>
        cat /etc/profile.d/jdk.sh
        <span class="hljs-built_in">export</span> JAVA_HOME=/usr/java/default
        <span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span>
        
        <span class="hljs-comment"># 变量在当前shell生效</span>
        <span class="hljs-built_in">source</span> /etc/profile
        
        <span class="hljs-comment"># 验证</span>
        java -version
    
    <span class="hljs-comment"># 源代码安装</span>
        <span class="hljs-comment"># 解压包</span>
        tar xvf jdk-8u241-linux-x64.tar.gz -C /usr/<span class="hljs-built_in">local</span>/
        
        <span class="hljs-comment"># 创建软链接</span>
        ln -s /usr/<span class="hljs-built_in">local</span>/jdk1.8.0_241 /usr/<span class="hljs-built_in">local</span>/jdk
        
        <span class="hljs-comment"># 配置文件</span>
        cat /etc/profile.d/jdk.sh
        <span class="hljs-built_in">export</span> JAVA_HOME=/usr/<span class="hljs-built_in">local</span>/jdk
        <span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$PATH</span>:<span class="hljs-variable">$JAVA_HOME</span>/bin
        
        <span class="hljs-comment"># 变量在当前shell生效</span>
        <span class="hljs-built_in">source</span> /etc/profile
        
        <span class="hljs-comment"># 验证</span>
        java -version</code></pre></div>
<h2 id="tomcat源代码">tomcat源代码</h2>
<ul>
<li>目前比较主流的Tomcat是<code>8.5.X</code>/<code>9.x</code>版本</li>
</ul>
<div><pre class="hljs"><code><span class="hljs-comment"># tomcat下载</span>
&gt;&gt; https://tomcat.apache.org/download-80.cgi
&gt;&gt; https://tomcat.apache.org/download-90.cgi

<span class="hljs-comment"># 解压包</span>
tomcat_ver=<span class="hljs-string">"9.0.87"</span>
tar xf apache-tomcat-<span class="hljs-variable">${tomcat_ver}</span>.tar.gz -C /usr/<span class="hljs-built_in">local</span>/

<span class="hljs-comment"># 设置PATH变量</span>
cat /etc/profile.d/tomcat.sh
PATH=/usr/<span class="hljs-built_in">local</span>/tomcat/bin:<span class="hljs-variable">$PATH</span>

<span class="hljs-comment"># 设置软链接</span>
ln -s /usr/<span class="hljs-built_in">local</span>/apache-tomcat-<span class="hljs-variable">${tomcat_ver}</span> /usr/<span class="hljs-built_in">local</span>/tomcat
chown tomcat.tomcat /usr/<span class="hljs-built_in">local</span>/tomcat

<span class="hljs-comment"># 变量当前shell生效</span>
<span class="hljs-built_in">source</span> /etc/profile.d/tomcat.sh

<span class="hljs-comment"># 创建用户</span>
useradd -r -s /sbin/nologin tomcat
chown -R tomcat.tomcat /usr/<span class="hljs-built_in">local</span>/apache-tomcat-<span class="hljs-variable">${tomcat_ver}</span>/

<span class="hljs-comment"># 确认tomcat安装</span>
catalina.sh version

<span class="hljs-comment"># 开启服务 / 关闭服务</span>
startup.sh
catalina.sh stop

<span class="hljs-comment"># 确认服务</span>
ss -ntl
ps aux|grep tomcat

<span class="hljs-comment"># 配置systemd文件</span>
cat /etc/systemd/system/tomcat.service
[Unit]
Description=Tomcat
After=syslog.target network.target

[Service]
Type=forking
<span class="hljs-comment">#二选一</span>
EnvironmentFile=/usr/<span class="hljs-built_in">local</span>/tomcat/conf/tomcat.conf
<span class="hljs-comment">#或者，如果没有创建上面的/usr/local/tomcat/conf/tomcat.conf文件，可以加下面一行也可</span>
Environment=JAVA_HOME=/usr/<span class="hljs-built_in">local</span>/jdk
ExecStart=/usr/<span class="hljs-built_in">local</span>/tomcat/bin/startup.sh
ExecStop=/usr/<span class="hljs-built_in">local</span>/tomcat/bin/shutdown.sh
PrivateTmp=<span class="hljs-literal">true</span>
User=tomcat
Group=tomcat

[Install]
WantedBy=multi-user.target

<span class="hljs-comment"># 重载服务</span>
systemctl daemon-reload</code></pre></div>
</div>
      </article>
    </div>
  </body>
</html>
